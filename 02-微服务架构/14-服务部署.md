## 一 微服务部署方式

### 1.0 常用部署方式

目前常见的微服务的常见部署方式是：
- 蓝绿部署
- 滚动发布
- 灰度发布

### 1.1 蓝绿部署

蓝绿部署（Blue/Green Deployment）：在不停止旧版情况下，部署新版本，然后进行测试。确认新版没问题后，将流量切到新版本，然后旧版也升级到新版本。  

蓝绿部署是常见的零宕机（0 downtime）部署方式。其具体策略是：生产环境需要两组配置，一组是active（绿配置），一组是inactive配置（蓝配置）。用户只会访问到active的配置，即在绿色环境中运行当前生产环境中的应用，也即旧版应用。升级版本时，在蓝环境中部署、测试，如果运行无问题，则可以将负载均衡器指向蓝环境，删除绿色环境中的实例，否则可以直接回滚。  

蓝绿环境产生了额外的维护成本，且要考虑数据库与应用部署同步迁移、回滚的问题。  

### 1.2 滚动发布

滚动发布（Rolling Update）：一般停止一个或多个服务器，执行更新，并重新将其投入使用，周而复始，直到集群中所有的实例都更新成新版本。  

滚动发布对比蓝绿发布更加节省资源，但是滚动发布也有很多缺点：
- 没有一个确定的可运行环境，无法预知新版在线上环境是否可行
- 回滚困难，比如滚动到一百台服务器发现了问题，那么就要对这一百台服务器进行回滚

### 1.3 灰度发布/金丝雀发布

灰度发布也称为金丝雀发布。起源是金丝雀对矿井中的瓦斯很敏感，矿工下井之前先放金丝雀试探。  

灰度发布中，先启动一个新版应用，但是并不直接把流量切换过来，而是让测试人员对新版本进行线上测试，该启动的新版即是金丝雀。如果测试没有问题，那么切换少量用户过来，收集运行数据，进行新旧版本对比，也称为A/B测试。运行良好后，再逐步将更多的流量切换到新版，直到100%的流量都切换到新版。  


## 二 监控系统

常用的监控系统组件：
- InfluxDB：用于存储数据，即时序数据存储系统
- cAdvisor：用于数据采集。即时序数据收集系统，用于分析和展示容器运行状态的可视化工具
- Grafana：用于数据展示，即8时序数据分析系统。